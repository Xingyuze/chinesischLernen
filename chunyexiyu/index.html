<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã€Šæ˜¥å¤œå–œé›¨ã€‹å¢å¼ºé˜…è¯»å™¨</title>
    <style>
        body {
            font-family: "Microsoft YaHei", sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        h1 {
            text-align: center;
            color: #8B4513;
            margin-bottom: 30px;
        }
        a {
            font-size: 1.25rem;
            text-align: center;
            margin: auto;
        }
        .top-controls {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 20px;
  gap: 10px;
}

.top-controls a {
  font-size: 1.2rem;
  text-decoration: none;
  color: #8B4513;
}

#languageSelect {
  font-size: 1rem;
  padding: 5px 10px;
  border-radius: 4px;
}

        
        .poem-container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .poem-line {
            margin-bottom: 15px;
            line-height: 1.8;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
        }

        .char-container {
            position: relative;
            margin: 0 2px;
            cursor: pointer;
            text-align: center;
        }
        
        .char {
            font-size: 20px;
            display: block;
        }
        
        .pinyin {
            font-size: 12px;
            color: #E74C3C;
            display: none;
            position: absolute;
            top: -18px;
            left: 0;
            right: 0;
        }
        
        .translation {
            font-size: 12px;
            color: #3498DB;
            display: none;
            position: absolute;
            bottom: -18px;
            left: 0;
            right: 0;
        }
        
        .line-controls {
            margin-left: 15px;
            display: flex;
            gap: 10px;
        }
        
        button {
            padding: 5px 10px;
            background-color: #8B4513;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #A0522D;
        }
        
        .status-bar {
            margin-top: 20px;
            padding: 10px;
            background-color: #eee;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .instructions {
            margin-top: 30px;
            padding: 15px;
            background-color: #f8f8f8;
            border-left: 4px solid #8B4513;
        }
        .poem-line {
  display: flex;
  align-items: center;
  margin-bottom: 16px;
  gap: 12px; /* Abstand zwischen Text und Bild */
}

.line-image {
  height: 15rem;         /* HÃ¶he ungefÃ¤hr wie zweizeiliger Text */
  aspect-ratio: 1 / 1;   /* quadratisch */
  border-radius: 4px;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
  object-fit: cover;
}

  #translationCard {
    position: fixed;  /* fixed fÃ¼r viewport-bezug */
    background: #f0f0f0;
    border: 1px solid #aaa;
    padding: 2rem 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    display: none;
    max-width: 280px;
    font-size: 15px;
    z-index: 10000;

    /* zentrieren */
    top: 50%;
    right: 0;
    transform: translateY(-50%);
  }
#translationCard .close-btn {
  position: absolute;
  top: 8px;
  left: 8px;
  background: none;
  border: none;
  font-size: 18px;
  font-weight: bold;
  color: #999;
  cursor: pointer;
}

  #translationCard button:hover {
    background-color: #333
  }
    </style>
</head>
<body>
    <h1>ã€Šæ˜¥å¤œå–œé›¨ã€‹å¢å¼ºé˜…è¯»å™¨</h1>

    <div class="top-controls">
        <a href="https://baike.baidu.com/item/æ˜¥å¤œå–œé›¨/1714877">
            æŸ¥çœ‹è¦–é »è¬›è§£
        </a>
        <select id="languageSelect">
          <option value="en">English</option>
          <option value="de">Deutsch</option>
          <option value="fr">FranÃ§ais</option>
        </select>
      </div>
      
    <div class="poem-container" id="poemContainer">
        <!-- è¯—å¥å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
    </div>
    
    <div class="status-bar" id="statusBar">å°±ç»ª</div>
    
    <div id="translationCard"></div>

    <div class="instructions">
        <h3>ä½¿ç”¨è¯´æ˜ï¼š</h3>
        <p>1. ç‚¹å‡»æ±‰å­— - ç¬¬ä¸€æ¬¡æ˜¾ç¤ºæ‹¼éŸ³ï¼Œç¬¬äºŒæ¬¡æœ—è¯»å‘éŸ³ï¼Œç¬¬ä¸‰æ¬¡æ˜¾ç¤ºè‹±æ–‡ç¿»è¯‘</p>
        <p>2. æ¯è¡Œè¯—å¥åçš„æŒ‰é’®å¯ä»¥æœ—è¯»æ•´å¥æˆ–æ˜¾ç¤ºæ•´å¥ç¿»è¯‘</p>
    </div>

    <script>
        const translationCard = document.getElementById('translationCard');
        // è¯—æ­Œæ–‡æœ¬
        const poemText = `å¥½é›¨çŸ¥æ—¶èŠ‚ï¼Œå½“æ˜¥ä¹ƒå‘ç”Ÿã€‚
éšé£æ½œå…¥å¤œï¼Œæ¶¦ç‰©ç»†æ— å£°ã€‚
é‡å¾„äº‘ä¿±é»‘ï¼Œæ±Ÿèˆ¹ç«ç‹¬æ˜ã€‚
æ™“çœ‹çº¢æ¹¿å¤„ï¼ŒèŠ±é‡é”¦å®˜åŸã€‚`;

        const lineImages = [
    'images/1.png', // z.B. FrÃ¼hling und Regen
    'images/2.png', // Nacht, Wind, Regen
    'images/3.png', // Nacht, Wind, Regen
    'images/4.png', // Nacht, Wind, Regen
];

        // ç¿»è¯‘æ•°æ® (ç¤ºä¾‹)
const translations_de = {}
const translations_fr = {
}
const translations_en = {
    "å¥½": "good",
    "é›¨": "rain",
    "çŸ¥": "know",
    "æ—¶": "time",
    "èŠ‚": "season",
    "å½“": "just at",
    "æ˜¥": "spring",
    "ä¹ƒ": "then",
    "å‘": "sprout",
    "ç”Ÿ": "grow",

    "éš": "follow",
    "é£": "wind",
    "æ½œ": "quietly enter",
    "å…¥": "enter",
    "å¤œ": "night",
    "æ¶¦": "moisten",
    "ç‰©": "things",
    "ç»†": "fine",
    "æ— ": "without",
    "å£°": "sound",

    "é‡": "wild",
    "å¾„": "path",
    "äº‘": "cloud",
    "ä¿±": "all",
    "é»‘": "dark",
    "æ±Ÿ": "river",
    "èˆ¹": "boat",
    "ç«": "fire",
    "ç‹¬": "alone",
    "æ˜": "bright",

    "æ™“": "dawn",
    "çœ‹": "look",
    "çº¢": "red",
    "æ¹¿": "wet",
    "å¤„": "place",
    "èŠ±": "flowers",
    "é‡": "heavy",
    "é”¦": "brocade",
    "å®˜": "official",
    "åŸ": "city"
};



        // åˆå§‹åŒ–è¯­éŸ³åˆæˆ
        const synth = window.speechSynthesis;
        let utterance = null;
        
        // çŠ¶æ€è·Ÿè¸ª
        const charStates = {};
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            renderPoem();
        });
        
        // æ¸²æŸ“è¯—æ­Œ
        function renderPoem() {
    const poemContainer = document.getElementById('poemContainer');
    const lines = poemText.split('\n');

    lines.forEach((line, index) => {
        const lineDiv = document.createElement('div');
        lineDiv.className = 'poem-line';

        // å¤„ç†æ¯ä¸ªå­—ç¬¦
        for (let i = 0; i < line.length; i++) {
            const char = line[i];

            if (char.trim() === '') {
                const spaceSpan = document.createElement('span');
                spaceSpan.textContent = ' ';
                lineDiv.appendChild(spaceSpan);
                continue;
            }

            const charContainer = document.createElement('div');
            charContainer.className = 'char-container';

            const charSpan = document.createElement('span');
            charSpan.className = 'char';
            charSpan.textContent = char;

            const pinyinSpan = document.createElement('span');
            pinyinSpan.className = 'pinyin';

            const transSpan = document.createElement('span');
            transSpan.className = 'translation';

            charContainer.appendChild(pinyinSpan);
            charContainer.appendChild(charSpan);
            charContainer.appendChild(transSpan);

            charContainer.addEventListener('click', () => handleCharClick(char, pinyinSpan, transSpan));

            lineDiv.appendChild(charContainer);
        }

        // è¡Œæ§åˆ¶æŒ‰é’®
        const controlsDiv = document.createElement('div');
        controlsDiv.className = 'line-controls';

        const readBtn = document.createElement('button');
        readBtn.textContent = 'æœ—è¯»';
        readBtn.addEventListener('click', () => readLine(line));

        const transBtn = document.createElement('button');
        transBtn.textContent = 'ç¿»è¯‘';
        transBtn.addEventListener('click', () => showLineTranslation(line));

        controlsDiv.appendChild(readBtn);
        controlsDiv.appendChild(transBtn);
        lineDiv.appendChild(controlsDiv);

        // ğŸ’¡ æ¯è¡Œåæ·»åŠ ä¸€ä¸ª individuelles Bild
        if (lineImages[index]) {
            const lineImage = document.createElement('img');
            lineImage.src = lineImages[index];
            lineImage.alt = 'Illustration';
            lineImage.className = 'line-image';
            lineDiv.appendChild(lineImage);

        }

        poemContainer.appendChild(lineDiv);
    });
}
        
        // å¤„ç†å­—ç¬¦ç‚¹å‡»
        function handleCharClick(char, pinyinSpan, transSpan) {
            const charId = `${char}-${pinyinSpan.id}`; // åˆ›å»ºå”¯ä¸€æ ‡è¯†
            
            // åˆå§‹åŒ–çŠ¶æ€
            if (!charStates[charId]) {
                charStates[charId] = 0;
            }
            
            // æ›´æ–°çŠ¶æ€
            charStates[charId]++;
            if (charStates[charId] > 3) {
                charStates[charId] = 1;
            }
            
            // æ ¹æ®çŠ¶æ€æ‰§è¡Œæ“ä½œ
            switch (charStates[charId]) {
                case 1: // æ˜¾ç¤ºæ‹¼éŸ³
                    showPinyin(char, pinyinSpan);
                    updateStatus(`æ˜¾ç¤ºæ‹¼éŸ³: ${char}`);
                    break;
                case 2: // æœ—è¯»å­—ç¬¦
                    readChar(char);
                    updateStatus(`æœ—è¯»å­—ç¬¦: ${char}`);
                    break;
                case 3: // æ˜¾ç¤ºç¿»è¯‘
                    showTranslation(char, transSpan);
                    updateStatus(`æ˜¾ç¤ºç¿»è¯‘: ${char}`);
                    break;
            }
        }
        
        // æ˜¾ç¤ºæ‹¼éŸ³
        function showPinyin(char, pinyinSpan) {
            // è¿™é‡Œåº”è¯¥è°ƒç”¨æ‹¼éŸ³åº“ï¼Œç®€åŒ–å¤„ç†
            const pinyinMap = {
    "å¥½": "hÇo",
    "é›¨": "yÇ”",
    "çŸ¥": "zhÄ«",
    "æ—¶": "shÃ­",
    "èŠ‚": "jiÃ©",
    "å½“": "dÄng",
    "æ˜¥": "chÅ«n",
    "ä¹ƒ": "nÇi",
    "å‘": "fÄ",
    "ç”Ÿ": "shÄ“ng",
    "éš": "suÃ­",
    "é£": "fÄ“ng",
    "æ½œ": "qiÃ¡n",
    "å…¥": "rÃ¹",
    "å¤œ": "yÃ¨",
    "æ¶¦": "rÃ¹n",
    "ç‰©": "wÃ¹",
    "ç»†": "xÃ¬",
    "æ— ": "wÃº",
    "å£°": "shÄ“ng",
    "é‡": "yÄ›",
    "å¾„": "jÃ¬ng",
    "äº‘": "yÃºn",
    "ä¿±": "jÃ¹",
    "é»‘": "hÄ“i",
    "æ±Ÿ": "jiÄng",
    "èˆ¹": "chuÃ¡n",
    "ç«": "huÇ’",
    "ç‹¬": "dÃº",
    "æ˜": "mÃ­ng",
    "æ™“": "xiÇo",
    "çœ‹": "kÃ n",
    "çº¢": "hÃ³ng",
    "æ¹¿": "shÄ«",
    "å¤„": "chÃ¹",
    "èŠ±": "huÄ",
    "é‡": "zhÃ²ng",
    "é”¦": "jÇn",
    "å®˜": "guÄn",
    "åŸ": "chÃ©ng"
};


            const py = pinyinMap[char] || "?";
            pinyinSpan.textContent = py;
            pinyinSpan.style.display = 'block';
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                pinyinSpan.style.display = 'none';
                // é‡ç½®çŠ¶æ€ä»¥ä¾¿ä¸‹æ¬¡ç‚¹å‡»
                const charId = `${char}-${pinyinSpan.id}`;
                charStates[charId] = 0;
            }, 8000);
        }
        
        // æœ—è¯»å­—ç¬¦
        function readChar(char) {
    if (synth.speaking) {
        synth.cancel();
    }
    
    utterance = new SpeechSynthesisUtterance(char);
    utterance.lang = 'zh-CN';
    utterance.rate = 0.7; // è®¾ç½®ä¸ºæ­£å¸¸é€Ÿåº¦çš„70%
    synth.speak(utterance);
}
        
        // æ˜¾ç¤ºç¿»è¯‘
function showTranslation(char, transSpan) {
    const lang = document.getElementById('languageSelect').value;

    const translationCard = document.getElementById('translationCard');

    const translateMap = {
        de: translations_de[char] || "Keine Ãœbersetzung",
        fr: translations_fr[char] || "Pas de traduction",
        en: translations_en[char] || "No translation"
    }
    const translate = translateMap[lang]
    translationCard.innerHTML = `
        <button class="close-btn" onclick="closeTranslationCard()">Ã—</button>
        <strong style="font-size: 18px;">æ±‰å­—ï¼š</strong> ${char}<br>
        <strong style="font-size: 18px;">ç¿»è¯‘: </strong> ${translate}
    `;

    translationCard.style.display = 'block';

    const charId = `${char}-${transSpan.id}`;
    charStates[charId] = 0;
}


function closeTranslationCard() {
  translationCard.style.display = 'none';
}
        
        // æœ—è¯»æ•´è¡Œ
        function readLine(line) {
    if (synth.speaking) {
        synth.cancel();
    }
    
    utterance = new SpeechSynthesisUtterance(line);
    utterance.lang = 'zh-CN';
    utterance.rate = 0.6; // è®¾ç½®ä¸ºæ­£å¸¸é€Ÿåº¦çš„60%ï¼Œæ›´æ…¢ä¸€äº›
    synth.speak(utterance);
    
    updateStatus(`æœ—è¯»: ${line}`);
}

        
        const tianwen_translation_map_fr = {}
        const tianwen_translation_map_de = {}
        const tianwen_translation_map_en = {
    "å¥½é›¨çŸ¥æ—¶èŠ‚ï¼Œå½“æ˜¥ä¹ƒå‘ç”Ÿã€‚": "A good rain knows its proper time; it comes in spring when life begins.",
    "éšé£æ½œå…¥å¤œï¼Œæ¶¦ç‰©ç»†æ— å£°ã€‚": "With the wind it slips into the night, moistening all things softly, without a sound.",
    "é‡å¾„äº‘ä¿±é»‘ï¼Œæ±Ÿèˆ¹ç«ç‹¬æ˜ã€‚": "On country paths, clouds turn all to darkness; only a riverboatâ€™s fire glows alone.",
    "æ™“çœ‹çº¢æ¹¿å¤„ï¼ŒèŠ±é‡é”¦å®˜åŸã€‚": "At dawn, weâ€™ll see the red, damp blossomsâ€”heavy with bloomâ€”in brocade-covered Chengdu."
};

function showLineTranslation(line) {
    const lang = document.getElementById('languageSelect').value;
      const translatedMap = {
        de: tianwen_translation_map_de,
        fr: tianwen_translation_map_fr,
        en: tianwen_translation_map_en
    };
    const translatedLine = translatedMap[lang]?.[line] || "ï¼ˆkeine Ãœbersetzung gefundenï¼‰";
    const translationCard = document.getElementById('translationCard');

    translationCard.innerHTML = `
        <button class="close-btn" onclick="closeTranslationCard()">Ã—</button>
        <strong style="font-size: 18px;">åŸæ–‡ï¼š</strong><br>
        <div style="margin-bottom: 10px;">${line}</div>
        <strong style="font-size: 18px;">ç¿»è¯‘ï¼š</strong><br>
        <div>${translatedLine}</div>
    `;

    translationCard.style.display = 'block';

    updateStatus(`æ˜¾ç¤ºç¿»è¯‘: ${line.substring(0, 15)}...`);
}
        
        // æ›´æ–°çŠ¶æ€æ 
        function updateStatus(message) {
            document.getElementById('statusBar').textContent = message;
        }
    </script>
</body>
</html>